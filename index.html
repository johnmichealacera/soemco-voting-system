<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procurement Information System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --light-bg: #f8f9fa;
            --border-color: #dee2e6;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }
        
        .navbar {
            background-color: var(--primary-color) !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            color: white !important;
            font-size: 1.5rem;
        }
        
        .sidebar {
            background-color: white;
            min-height: calc(100vh - 56px);
            box-shadow: 0 0 15px rgba(0,0,0,0.05);
            position: sticky;
            top: 56px;
            z-index: 100;
        }
        
        .sidebar .nav-link {
            color: var(--primary-color);
            padding: 12px 20px;
            border-left: 4px solid transparent;
            transition: all 0.2s;
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: rgba(52, 152, 219, 0.1);
            border-left-color: var(--secondary-color);
            color: var(--secondary-color);
        }
        
        .sidebar .nav-link i {
            width: 24px;
            text-align: center;
            margin-right: 10px;
        }
        
        .main-content {
            padding: 25px;
            background-color: var(--light-bg);
            min-height: calc(100vh - 56px);
        }
        
        .card {
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 25px;
            border-radius: 10px;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background-color: white;
            border-bottom: 2px solid var(--border-color);
            font-weight: 600;
            color: var(--primary-color);
            padding: 15px 20px;
            border-radius: 10px 10px 0 0 !important;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-draft {
            background-color: #f8f9fa;
            color: #6c757d;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-approved {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-published {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .status-cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .table th {
            background-color: var(--light-bg);
            border-top: none;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
        }
        
        .btn-danger {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .role-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
        }
        
        .role-card {
            width: 220px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .role-card:hover {
            border-color: var(--secondary-color);
            transform: scale(1.05);
        }
        
        .role-icon {
            font-size: 3rem;
            color: var(--secondary-color);
            margin-bottom: 15px;
        }
        
        .module-title {
            color: var(--primary-color);
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 10px;
            margin-bottom: 25px;
        }
        
        .modal-header {
            background-color: var(--primary-color);
            color: white;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            padding: 20px;
            border-radius: 10px;
            color: white;
            text-align: center;
        }
        
        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .stat-card h3 {
            font-size: 2.2rem;
            margin-bottom: 5px;
        }
        
        .stat-card p {
            margin: 0;
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .stat-office { background: linear-gradient(135deg, #3498db, #2c3e50); }
        .stat-gso { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .stat-bac { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        .stat-budget { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        
        /* Breadcrumb */
        .breadcrumb {
            background-color: white;
            border-radius: 8px;
            padding: 12px 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .breadcrumb-item a {
            color: var(--secondary-color);
            text-decoration: none;
            font-weight: 500;
        }
        
        .breadcrumb-item.active {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        /* Item management styles */
        .item-actions {
            white-space: nowrap;
        }
        
        .monthly-qty-input {
            width: 60px;
            display: inline-block;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .monthly-qty-label {
            font-size: 0.8rem;
            color: #6c757d;
            margin-right: 10px;
            width: 30px;
            display: inline-block;
            text-align: center;
        }
        
        .monthly-breakdown {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .item-details-card {
            border-left: 4px solid var(--secondary-color);
        }
        
        @media (max-width: 768px) {
            .sidebar {
                min-height: auto;
                position: relative;
                top: 0;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
            
            .item-actions {
                white-space: normal;
            }
            
            .monthly-qty-input {
                width: 50px;
            }
        }
    </style>
</head>
<body>
    <!-- Role Selection Screen -->
    <div id="roleSelection" class="container-fluid py-5">
        <div class="row justify-content-center">
            <div class="col-md-10 text-center">
                <h1 class="display-4 mb-4" style="color: var(--primary-color);">Procurement Information System</h1>
                <p class="lead mb-5">Select your role to access the system modules</p>
                
                <div class="role-selector">
                    <div class="role-card card text-center p-4" onclick="selectRole('office')">
                        <div class="role-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <h4>Office</h4>
                        <p class="text-muted">Employee / Department Head</p>
                        <div class="mt-3">
                            <span class="badge bg-primary">PPMP Management</span>
                            <span class="badge bg-primary">Purchase Requests</span>
                        </div>
                    </div>
                    
                    <div class="role-card card text-center p-4" onclick="selectRole('gso')">
                        <div class="role-icon">
                            <i class="fas fa-clipboard-check"></i>
                        </div>
                        <h4>GSO Officer</h4>
                        <p class="text-muted">General Services Office</p>
                        <div class="mt-3">
                            <span class="badge bg-success">RFQ Creation</span>
                            <span class="badge bg-success">PR Validation</span>
                        </div>
                    </div>
                    
                    <div class="role-card card text-center p-4" onclick="selectRole('bac')">
                        <div class="role-icon">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <h4>BAC Secretary</h4>
                        <p class="text-muted">Bids & Awards Committee</p>
                        <div class="mt-3">
                            <span class="badge bg-purple">PHILGEPS Posting</span>
                            <span class="badge bg-purple">APP Consolidation</span>
                        </div>
                    </div>
                    
                    <div class="role-card card text-center p-4" onclick="selectRole('budget')">
                        <div class="role-icon">
                            <i class="fas fa-money-check-alt"></i>
                        </div>
                        <h4>Budget Officer</h4>
                        <p class="text-muted">Budget Management</p>
                        <div class="mt-3">
                            <span class="badge bg-danger">Appropriations</span>
                            <span class="badge bg-danger">PR Validation</span>
                        </div>
                    </div>
                </div>
                
                <div class="mt-5">
                    <p class="text-muted"><small>For demonstration purposes, you can switch roles at any time</small></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application Interface (Hidden Initially) -->
    <div id="mainApp" style="display: none;">
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-clipboard-list me-2"></i>
                    Procurement Information System
                </a>
                
                <div class="d-flex align-items-center">
                    <div class="dropdown me-3">
                        <button class="btn btn-light btn-sm dropdown-toggle" type="button" id="roleDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user me-1"></i>
                            <span id="currentRole">Office</span>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="roleDropdown">
                            <li><a class="dropdown-item" href="#" onclick="switchRole('office')"><i class="fas fa-building me-2"></i>Office</a></li>
                            <li><a class="dropdown-item" href="#" onclick="switchRole('gso')"><i class="fas fa-clipboard-check me-2"></i>GSO Officer</a></li>
                            <li><a class="dropdown-item" href="#" onclick="switchRole('bac')"><i class="fas fa-file-contract me-2"></i>BAC Secretary</a></li>
                            <li><a class="dropdown-item" href="#" onclick="switchRole('budget')"><i class="fas fa-money-check-alt me-2"></i>Budget Officer</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                        </ul>
                    </div>
                    
                    <div class="text-white">
                        <i class="fas fa-calendar-alt me-1"></i>
                        <span id="currentDate"></span>
                    </div>
                </div>
            </div>
        </nav>
        
        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-lg-2 col-md-3 p-0">
                    <div class="sidebar">
                        <nav class="nav flex-column py-3">
                            <!-- Dynamic sidebar content based on role -->
                            <div id="sidebarContent"></div>
                        </nav>
                    </div>
                </div>
                
                <!-- Main Content Area -->
                <div class="col-lg-10 col-md-9 p-0">
                    <div class="main-content" id="mainContent">
                        <!-- Breadcrumb Navigation -->
                        <nav id="breadcrumbNav" aria-label="breadcrumb" style="display: none;">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#" onclick="loadModule('dashboard')">Dashboard</a></li>
                                <li class="breadcrumb-item"><a href="#" onclick="loadModule('ppmp')">PPMP Management</a></li>
                                <!-- Dynamic breadcrumb items will be added here -->
                            </ol>
                        </nav>
                        
                        <!-- Dynamic content will be loaded here based on module -->
                        <div id="moduleContent">
                            <div class="text-center py-5">
                                <h2 class="mb-3">Welcome to Procurement Information System</h2>
                                <p class="lead text-muted">Select a module from the sidebar to get started</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Create PPMP Modal -->
    <div class="modal fade" id="createPpmpModal" tabindex="-1" aria-labelledby="createPpmpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createPpmpModalLabel">Create New PPMP</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="ppmpForm">
                        <input type="hidden" id="ppmpId" value="">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="ppmpType" class="form-label">PPMP Type</label>
                                <select class="form-select" id="ppmpType" required>
                                    <option value="">Select Type</option>
                                    <option value="regular">Regular PPMP (Annual)</option>
                                    <option value="supplemental">Supplemental PPMP</option>
                                </select>
                                <div class="form-text">Regular PPMP is entered once per year. Supplemental PPMP supports items not in the regular PPMP.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="ppmpYear" class="form-label">Fiscal Year</label>
                                <input type="number" class="form-control" id="ppmpYear" min="2023" max="2030" value="2024" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="ppmpTitle" class="form-label">PPMP Title/Description</label>
                            <input type="text" class="form-control" id="ppmpTitle" placeholder="Enter PPMP title or description" required>
                        </div>
                        <div class="mb-3">
                            <label for="ppmpOffice" class="form-label">Office/Department</label>
                            <input type="text" class="form-control" id="ppmpOffice" value="Office of the Mayor" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="ppmpDeadline" class="form-label">Modification Deadline</label>
                            <input type="date" class="form-control" id="ppmpDeadline" required>
                            <div class="form-text">After this date, the PPMP can no longer be modified by the office.</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="savePPMP()">Save PPMP</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add/Edit Item to PPMP Modal -->
    <div class="modal fade" id="itemModal" tabindex="-1" aria-labelledby="itemModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="itemModalLabel">Add Item to PPMP</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="itemForm">
                        <input type="hidden" id="itemId" value="">
                        <input type="hidden" id="itemPpmpId" value="">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="itemName" class="form-label">Item Name</label>
                                <input type="text" class="form-control" id="itemName" placeholder="Enter item name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="itemUnit" class="form-label">Unit</label>
                                <select class="form-select" id="itemUnit" required>
                                    <option value="">Select Unit</option>
                                    <option value="piece">Piece</option>
                                    <option value="box">Box</option>
                                    <option value="ream">Ream</option>
                                    <option value="liter">Liter</option>
                                    <option value="gallon">Gallon</option>
                                    <option value="set">Set</option>
                                    <option value="lot">Lot</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="itemUnitPrice" class="form-label">Unit Price (PHP)</label>
                                <input type="number" class="form-control" id="itemUnitPrice" min="0" step="0.01" placeholder="0.00" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="itemQuantity" class="form-label">Total Quantity (Year)</label>
                                <input type="number" class="form-control" id="itemQuantity" min="1" placeholder="0" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Monthly Quantity Breakdown</label>
                            <div class="monthly-breakdown">
                                <div class="row g-2">
                                    <div class="col-4 col-md-2">
                                        <label class="form-label small">Jan</label>
                                        <input type="number" class="form-control form-control-sm monthly-qty" id="qtyJan" min="0" value="0" data-month="0">
                                    </div>
                                    <div class="col-4 col-md-2">
                                        <label class="form-label small">Feb</label>
                                        <input type="number" class="form-control form-control-sm monthly-qty" id="qtyFeb" min="0" value="0" data-month="1">
                                    </div>
                                    <div class="col-4 col-md-2">
                                        <label class="form-label small">Mar</label>
                                        <input type="number" class="form-control form-control-sm monthly-qty" id="qtyMar" min="0" value="0" data-month="2">
                                    </div>
                                    <div class="col-4 col-md-2">
                                        <label class="form-label small">Apr</label>
                                        <input type="number" class="form-control form-control-sm monthly-qty" id="qtyApr" min="0" value="0" data-month="3">
                                    </div>
                                    <div class="col-4 col-md-2">
                                        <label class="form-label small">May</label>
                                        <input type="number" class="form-control form-control-sm monthly-qty" id="qtyMay" min="0" value="0" data-month="4">
                                    </div>
                                    <div class="col-4 col-md-2">
                                        <label class="form-label small">Jun</label>
                                        <input type="number" class="form-control form-control-sm monthly-qty" id="qtyJun" min="0" value="0" data-month="5">
                                    </div>
                                    <div class="col-4 col-md-2">
                                        <label class="form-label small">Jul</label>
                                        <input type="number" class="form-control form-control-sm monthly-qty" id="qtyJul" min="0" value="0" data-month="6">
                                    </div>
                                    <div class="col-4 col-md-2">
                                        <label class="form-label small">Aug</label>
                                        <input type="number" class="form-control form-control-sm monthly-qty" id="qtyAug" min="0" value="0" data-month="7">
                                    </div>
                                    <div class="col-4 col-md-2">
                                        <label class="form-label small">Sep</label>
                                        <input type="number" class="form-control form-control-sm monthly-qty" id="qtySep" min="0" value="0" data-month="8">
                                    </div>
                                    <div class="col-4 col-md-2">
                                        <label class="form-label small">Oct</label>
                                        <input type="number" class="form-control form-control-sm monthly-qty" id="qtyOct" min="0" value="0" data-month="9">
                                    </div>
                                    <div class="col-4 col-md-2">
                                        <label class="form-label small">Nov</label>
                                        <input type="number" class="form-control form-control-sm monthly-qty" id="qtyNov" min="0" value="0" data-month="10">
                                    </div>
                                    <div class="col-4 col-md-2">
                                        <label class="form-label small">Dec</label>
                                        <input type="number" class="form-control form-control-sm monthly-qty" id="qtyDec" min="0" value="0" data-month="11">
                                    </div>
                                </div>
                            </div>
                            <div class="form-text mt-2">Total quantity is based on monthly values from January to December. <span id="monthlyTotal">Total: 0</span></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="savePPMPItem()">Save Item</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="deleteConfirmText">Are you sure you want to delete this item?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // System Data Storage
        let systemData = {
            currentRole: 'office',
            currentModule: 'dashboard',
            currentPPMPId: null,
            ppmpData: [],
            prData: [],
            rfqData: [],
            appData: [],
            offices: ['Office of the Mayor', 'Engineering Office', 'Health Office', 'Education Office', 'Finance Office'],
            currentUser: 'Employee',
            currentOffice: 'Office of the Mayor'
        };

        // Initialize with sample data
        function initializeData() {
            // Sample PPMP data
            systemData.ppmpData = [
                {
                    id: 1,
                    office: 'Office of the Mayor',
                    type: 'regular',
                    year: 2024,
                    title: 'Office Supplies and Equipment 2024',
                    status: 'draft',
                    deadline: '2024-03-31',
                    createdDate: '2024-01-15',
                    items: [
                        { id: 1, name: 'Bond Paper (A4)', unit: 'ream', unitPrice: 250.00, totalQty: 120, monthlyQty: [10,10,10,10,10,10,10,10,10,10,10,10], totalAmount: 30000.00 },
                        { id: 2, name: 'Printer Ink (Black)', unit: 'piece', unitPrice: 1200.00, totalQty: 24, monthlyQty: [2,2,2,2,2,2,2,2,2,2,2,2], totalAmount: 28800.00 },
                        { id: 3, name: 'Office Chairs', unit: 'piece', unitPrice: 3500.00, totalQty: 5, monthlyQty: [0,0,0,5,0,0,0,0,0,0,0,0], totalAmount: 17500.00 }
                    ]
                },
                {
                    id: 2,
                    office: 'Engineering Office',
                    type: 'regular',
                    year: 2024,
                    title: 'Construction Materials 2024',
                    status: 'approved',
                    deadline: '2024-03-15',
                    createdDate: '2024-01-10',
                    items: [
                        { id: 4, name: 'Cement', unit: 'bag', unitPrice: 280.00, totalQty: 500, monthlyQty: [50,50,50,50,50,50,50,50,50,50,0,0], totalAmount: 140000.00 },
                        { id: 5, name: 'Steel Bars', unit: 'piece', unitPrice: 450.00, totalQty: 1000, monthlyQty: [100,100,100,100,100,100,100,100,100,100,0,0], totalAmount: 450000.00 }
                    ]
                }
            ];

            // Sample PR data
            systemData.prData = [
                {
                    id: 1,
                    office: 'Office of the Mayor',
                    title: 'Q1 Office Supplies',
                    purpose: 'First quarter office supplies procurement',
                    source: 'ppmp',
                    items: [1, 2],
                    totalAmount: 40800.00,
                    status: 'approved',
                    createdDate: '2024-02-10',
                    approvedDate: '2024-02-12',
                    approvedBy: 'Dept. Head'
                },
                {
                    id: 2,
                    office: 'Engineering Office',
                    title: 'Construction Materials for Road Repair',
                    purpose: 'Materials for municipal road repair project',
                    source: 'ppmp',
                    items: [4, 5],
                    totalAmount: 590000.00,
                    status: 'pending',
                    createdDate: '2024-02-15',
                    approvedDate: null,
                    approvedBy: null
                }
            ];

            // Sample RFQ data
            systemData.rfqData = [
                {
                    id: 1,
                    title: 'Office Supplies RFQ 2024-001',
                    prIds: [1],
                    totalAmount: 40800.00,
                    status: 'for_disbursement',
                    createdDate: '2024-02-14',
                    publishedDate: null,
                    processRule: 'below_200k'
                }
            ];

            // Sample APP data
            systemData.appData = [
                {
                    id: 1,
                    year: 2024,
                    status: 'draft',
                    createdDate: '2024-01-20',
                    items: []
                }
            ];
        }

        // Role Selection Functions
        function selectRole(role) {
            systemData.currentRole = role;
            document.getElementById('roleSelection').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('currentRole').textContent = getRoleName(role);
            
            // Set current user based on role
            if (role === 'office') {
                systemData.currentUser = 'Employee';
            } else if (role === 'gso') {
                systemData.currentUser = 'GSO Officer';
            } else if (role === 'bac') {
                systemData.currentUser = 'BAC Secretary';
            } else if (role === 'budget') {
                systemData.currentUser = 'Budget Officer';
            }
            
            updateDate();
            loadSidebar();
            loadDashboard();
        }

        function switchRole(role) {
            selectRole(role);
        }

        function logout() {
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('roleSelection').style.display = 'block';
        }

        function getRoleName(role) {
            switch(role) {
                case 'office': return 'Office';
                case 'gso': return 'GSO Officer';
                case 'bac': return 'BAC Secretary';
                case 'budget': return 'Budget Officer';
                default: return 'Office';
            }
        }

        // Date Display
        function updateDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
        }

        // Sidebar Management
        function loadSidebar() {
            let sidebarContent = '';
            
            if (systemData.currentRole === 'office') {
                sidebarContent = `
                    <a class="nav-link active" href="#" onclick="loadModule('dashboard')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a class="nav-link" href="#" onclick="loadModule('ppmp')">
                        <i class="fas fa-file-alt"></i> PPMP Management
                    </a>
                    <a class="nav-link" href="#" onclick="loadModule('pr')">
                        <i class="fas fa-shopping-cart"></i> Purchase Requests
                    </a>
                    <a class="nav-link" href="#" onclick="loadModule('reports')">
                        <i class="fas fa-chart-bar"></i> Reports
                    </a>
                `;
            } else if (systemData.currentRole === 'gso') {
                sidebarContent = `
                    <a class="nav-link active" href="#" onclick="loadModule('dashboard')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a class="nav-link" href="#" onclick="loadModule('validate')">
                        <i class="fas fa-check-circle"></i> Validate PR/PPMP
                    </a>
                    <a class="nav-link" href="#" onclick="loadModule('rfq')">
                        <i class="fas fa-file-contract"></i> RFQ Management
                    </a>
                    <a class="nav-link" href="#" onclick="loadModule('status')">
                        <i class="fas fa-sync-alt"></i> Update PR Status
                    </a>
                    <a class="nav-link" href="#" onclick="loadModule('reports')">
                        <i class="fas fa-chart-bar"></i> Reports
                    </a>
                `;
            } else if (systemData.currentRole === 'bac') {
                sidebarContent = `
                    <a class="nav-link active" href="#" onclick="loadModule('dashboard')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a class="nav-link" href="#" onclick="loadModule('validate')">
                        <i class="fas fa-check-circle"></i> Validate PR/PPMP
                    </a>
                    <a class="nav-link" href="#" onclick="loadModule('philgeps')">
                        <i class="fas fa-globe"></i> PHILGEPS Posting
                    </a>
                    <a class="nav-link" href="#" onclick="loadModule('app')">
                        <i class="fas fa-clipboard-list"></i> Annual Procurement Plan
                    </a>
                    <a class="nav-link" href="#" onclick="loadModule('reports')">
                        <i class="fas fa-chart-bar"></i> Reports
                    </a>
                `;
            } else if (systemData.currentRole === 'budget') {
                sidebarContent = `
                    <a class="nav-link active" href="#" onclick="loadModule('dashboard')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a class="nav-link" href="#" onclick="loadModule('validate')">
                        <i class="fas fa-check-circle"></i> Validate PR/PPMP
                    </a>
                    <a class="nav-link" href="#" onclick="loadModule('appropriation')">
                        <i class="fas fa-hand-holding-usd"></i> Appropriations
                    </a>
                    <a class="nav-link" href="#" onclick="loadModule('reports')">
                        <i class="fas fa-chart-bar"></i> Reports
                    </a>
                `;
            }
            
            document.getElementById('sidebarContent').innerHTML = sidebarContent;
        }

        // Breadcrumb Management
        function updateBreadcrumb(items) {
            const breadcrumbNav = document.getElementById('breadcrumbNav');
            const breadcrumb = breadcrumbNav.querySelector('.breadcrumb');
            
            // Keep the first two items (Dashboard and PPMP Management)
            const currentItems = breadcrumb.querySelectorAll('.breadcrumb-item');
            for (let i = 2; i < currentItems.length; i++) {
                currentItems[i].remove();
            }
            
            // Add new breadcrumb items
            items.forEach(item => {
                const li = document.createElement('li');
                li.className = 'breadcrumb-item';
                
                if (item.active) {
                    li.classList.add('active');
                    li.textContent = item.text;
                } else {
                    const a = document.createElement('a');
                    a.href = '#';
                    a.textContent = item.text;
                    if (item.onclick) {
                        a.onclick = item.onclick;
                    }
                    li.appendChild(a);
                }
                
                breadcrumb.appendChild(li);
            });
            
            breadcrumbNav.style.display = 'block';
        }

        // Module Loading
        function loadModule(module) {
            systemData.currentModule = module;
            
            // Update active state in sidebar
            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Update breadcrumb
            document.getElementById('breadcrumbNav').style.display = 'none';
            
            // Load module content
            switch(module) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'ppmp':
                    loadPPMPModule();
                    break;
                case 'pr':
                    loadPRModule();
                    break;
                case 'validate':
                    loadValidateModule();
                    break;
                case 'rfq':
                    loadRFQModule();
                    break;
                case 'status':
                    loadStatusModule();
                    break;
                case 'philgeps':
                    loadPhilgepsModule();
                    break;
                case 'app':
                    loadAPPModule();
                    break;
                case 'appropriation':
                    loadAppropriationModule();
                    break;
                case 'reports':
                    loadReportsModule();
                    break;
            }
        }

        // Dashboard Module
        function loadDashboard() {
            let content = '';
            
            if (systemData.currentRole === 'office') {
                const officePPMPs = systemData.ppmpData.filter(ppmp => ppmp.office === systemData.currentOffice);
                const officePRs = systemData.prData.filter(pr => pr.office === systemData.currentOffice);
                
                content = `
                    <h2 class="module-title">Office Dashboard</h2>
                    
                    <div class="dashboard-stats">
                        <div class="stat-card stat-office">
                            <i class="fas fa-file-alt"></i>
                            <h3>${officePPMPs.length}</h3>
                            <p>PPMPs</p>
                        </div>
                        <div class="stat-card stat-office">
                            <i class="fas fa-shopping-cart"></i>
                            <h3>${officePRs.length}</h3>
                            <p>Purchase Requests</p>
                        </div>
                        <div class="stat-card stat-office">
                            <i class="fas fa-check-circle"></i>
                            <h3>${officePRs.filter(pr => pr.status === 'approved').length}</h3>
                            <p>Approved PRs</p>
                        </div>
                        <div class="stat-card stat-office">
                            <i class="fas fa-clock"></i>
                            <h3>${officePRs.filter(pr => pr.status === 'pending').length}</h3>
                            <p>Pending PRs</p>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-exclamation-circle me-2"></i> Recent Alerts
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-warning">
                                        <strong>PPMP Modification Deadline:</strong> Your regular PPMP for 2024 can be modified until March 31, 2024.
                                    </div>
                                    <div class="alert alert-info">
                                        <strong>New Feature:</strong> You can now create supplemental PPMPs for items not in your regular PPMP.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-history me-2"></i> Recent Activities
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <span>Created PR "Q1 Office Supplies"</span>
                                            <small class="text-muted">Feb 10, 2024</small>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <span>Updated PPMP "Office Supplies 2024"</span>
                                            <small class="text-muted">Feb 5, 2024</small>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <span>Published PPMP "Office Supplies 2024"</span>
                                            <small class="text-muted">Jan 20, 2024</small>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-file-alt me-2"></i> My PPMPs</span>
                            <button class="btn btn-primary btn-sm" onclick="openCreatePpmpModal()">
                                <i class="fas fa-plus me-1"></i> Create PPMP
                            </button>
                        </div>
                        <div class="card-body">
                            ${renderPPMPTable(officePPMPs, true)}
                        </div>
                    </div>
                `;
            } else if (systemData.currentRole === 'gso') {
                // GSO Dashboard content (unchanged)
                content = `<h2 class="module-title">GSO Officer Dashboard</h2>`;
            } else if (systemData.currentRole === 'bac') {
                // BAC Dashboard content (unchanged)
                content = `<h2 class="module-title">BAC Secretary Dashboard</h2>`;
            } else if (systemData.currentRole === 'budget') {
                // Budget Dashboard content (unchanged)
                content = `<h2 class="module-title">Budget Officer Dashboard</h2>`;
            }
            
            document.getElementById('moduleContent').innerHTML = content;
        }

        // PPMP Module
        function loadPPMPModule() {
            const officePPMPs = systemData.ppmpData.filter(ppmp => ppmp.office === systemData.currentOffice);
            
            // Update breadcrumb
            updateBreadcrumb([
                { text: 'PPMP Management', active: true }
            ]);
            
            let content = `
                <h2 class="module-title">PPMP Management</h2>
                
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-file-alt me-2"></i> Project Procurement Management Plans</span>
                        <div>
                            <button class="btn btn-primary btn-sm me-2" onclick="openCreatePpmpModal()">
                                <i class="fas fa-plus me-1"></i> Create PPMP
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="loadDashboard()">
                                <i class="fas fa-tachometer-alt me-1"></i> Dashboard
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info mb-4">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>PPMP Types:</strong> 
                            <ul class="mb-0 mt-2">
                                <li><strong>Regular PPMP:</strong> Entered once per year. Only one regular PPMP per office per year.</li>
                                <li><strong>Supplemental PPMP:</strong> Supports items not originally in the regular PPMP.</li>
                            </ul>
                        </div>
                        
                        ${renderPPMPTable(officePPMPs, false)}
                    </div>
                </div>
            `;
            
            document.getElementById('moduleContent').innerHTML = content;
        }

        function renderPPMPTable(ppmpList, isDashboard = false) {
            if (ppmpList.length === 0) {
                return `<div class="alert alert-info">No PPMPs found. Click "Create PPMP" to add one.</div>`;
            }
            
            let table = `
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Year</th>
                                <th>Status</th>
                                <th>Deadline</th>
                                <th>Items</th>
                                <th>Total Amount</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            ppmpList.forEach(ppmp => {
                const statusClass = `status-${ppmp.status}`;
                const typeLabel = ppmp.type === 'regular' ? '<span class="badge bg-primary">Regular</span>' : '<span class="badge bg-warning">Supplemental</span>';
                const statusLabel = `<span class="status-badge ${statusClass}">${ppmp.status}</span>`;
                const itemCount = ppmp.items ? ppmp.items.length : 0;
                const totalAmount = ppmp.items ? ppmp.items.reduce((sum, item) => sum + (item.unitPrice * item.totalQty), 0) : 0;
                
                table += `
                    <tr>
                        <td>PPMP-${ppmp.id}</td>
                        <td>${ppmp.title}</td>
                        <td>${typeLabel}</td>
                        <td>${ppmp.year}</td>
                        <td>${statusLabel}</td>
                        <td>${ppmp.deadline}</td>
                        <td>${itemCount} items</td>
                        <td>PHP ${totalAmount.toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                        <td class="item-actions">
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="viewPPMP(${ppmp.id})" title="View PPMP">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${ppmp.status !== 'published' ? `
                                <button class="btn btn-sm btn-outline-success me-1" onclick="editPPMP(${ppmp.id})" title="Edit PPMP">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deletePPMP(${ppmp.id})" title="Delete PPMP">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            });
            
            table += `
                        </tbody>
                    </table>
                </div>
            `;
            
            return table;
        }

        // View PPMP Details with Items
        function viewPPMP(ppmpId) {
            const ppmp = systemData.ppmpData.find(p => p.id == ppmpId);
            if (!ppmp) return;
            
            systemData.currentPPMPId = ppmpId;
            
            // Update breadcrumb
            updateBreadcrumb([
                { text: 'PPMP Details', active: true }
            ]);
            
            let content = `
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="module-title mb-0">PPMP Details: ${ppmp.title}</h2>
                    <button class="btn btn-outline-primary" onclick="loadPPMPModule()">
                        <i class="fas fa-arrow-left me-1"></i> Back to PPMP List
                    </button>
                </div>

                <div class="card mb-4 item-details-card">
                    <div class="card-header">
                        <h5 class="mb-0">PPMP Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Title:</strong> ${ppmp.title}</p>
                                <p><strong>Type:</strong> ${ppmp.type === 'regular' ? 'Regular PPMP (Annual)' : 'Supplemental PPMP'}</p>
                                <p><strong>Fiscal Year:</strong> ${ppmp.year}</p>
                                <p><strong>Office:</strong> ${ppmp.office}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Status:</strong> <span class="status-badge status-${ppmp.status}">${ppmp.status}</span></p>
                                <p><strong>Modification Deadline:</strong> ${ppmp.deadline}</p>
                                <p><strong>Created Date:</strong> ${ppmp.createdDate}</p>
                                <p><strong>Total Items:</strong> ${ppmp.items.length}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-boxes me-2"></i> PPMP Items / Products</h5>
                        ${ppmp.status !== 'published' ? `
                            <button class="btn btn-primary btn-sm" onclick="openAddItemModal(${ppmp.id})">
                                <i class="fas fa-plus me-1"></i> Add Item
                            </button>
                        ` : ''}
                    </div>
                    <div class="card-body">
                        ${renderPPMPItemsTable(ppmp)}
                    </div>
                </div>
            `;
            
            document.getElementById('moduleContent').innerHTML = content;
        }

        function renderPPMPItemsTable(ppmp) {
            if (!ppmp.items || ppmp.items.length === 0) {
                return `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No items found in this PPMP. ${ppmp.status !== 'published' ? 'Click "Add Item" to add products to this PPMP.' : ''}
                    </div>
                `;
            }
            
            let table = `
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Item ID</th>
                                <th>Item Name</th>
                                <th>Unit</th>
                                <th>Unit Price</th>
                                <th>Total Qty</th>
                                <th>Total Amount</th>
                                <th>Monthly Breakdown</th>
                                ${ppmp.status !== 'published' ? '<th>Actions</th>' : ''}
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            let grandTotal = 0;
            ppmp.items.forEach(item => {
                const totalAmount = item.unitPrice * item.totalQty;
                grandTotal += totalAmount;
                
                // Create monthly breakdown string
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                let monthlyBreakdown = '';
                item.monthlyQty.forEach((qty, index) => {
                    if (qty > 0) {
                        monthlyBreakdown += `<span class="badge bg-light text-dark me-1 mb-1">${months[index]}: ${qty}</span>`;
                    }
                });
                
                table += `
                    <tr>
                        <td>ITEM-${item.id}</td>
                        <td>${item.name}</td>
                        <td>${item.unit}</td>
                        <td>PHP ${item.unitPrice.toFixed(2)}</td>
                        <td>${item.totalQty}</td>
                        <td>PHP ${totalAmount.toFixed(2)}</td>
                        <td>${monthlyBreakdown}</td>
                        ${ppmp.status !== 'published' ? `
                            <td class="item-actions">
                                <button class="btn btn-sm btn-outline-success me-1" onclick="editItem(${ppmp.id}, ${item.id})" title="Edit Item">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="confirmDeleteItem(${ppmp.id}, ${item.id}, '${item.name}')" title="Delete Item">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        ` : ''}
                    </tr>
                `;
            });
            
            table += `
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="5" class="text-end"><strong>Grand Total:</strong></td>
                                <td><strong>PHP ${grandTotal.toFixed(2)}</strong></td>
                                <td colspan="${ppmp.status !== 'published' ? '2' : '1'}"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;
            
            return table;
        }

        // Open Create PPMP Modal
        function openCreatePpmpModal() {
            document.getElementById('ppmpId').value = '';
            document.getElementById('ppmpTitle').value = '';
            document.getElementById('ppmpType').value = '';
            document.getElementById('ppmpYear').value = '2024';
            
            // Set default deadline to 30 days from now
            const today = new Date();
            const nextMonth = new Date(today);
            nextMonth.setDate(today.getDate() + 30);
            document.getElementById('ppmpDeadline').valueAsDate = nextMonth;
            
            document.getElementById('createPpmpModalLabel').textContent = 'Create New PPMP';
            
            const modal = new bootstrap.Modal(document.getElementById('createPpmpModal'));
            modal.show();
        }

        // Edit PPMP
        function editPPMP(ppmpId) {
            const ppmp = systemData.ppmpData.find(p => p.id == ppmpId);
            if (!ppmp) return;
            
            document.getElementById('ppmpId').value = ppmp.id;
            document.getElementById('ppmpTitle').value = ppmp.title;
            document.getElementById('ppmpType').value = ppmp.type;
            document.getElementById('ppmpYear').value = ppmp.year;
            document.getElementById('ppmpDeadline').value = ppmp.deadline;
            
            document.getElementById('createPpmpModalLabel').textContent = 'Edit PPMP';
            
            const modal = new bootstrap.Modal(document.getElementById('createPpmpModal'));
            modal.show();
        }

        // Save PPMP (Create or Update)
        function savePPMP() {
            const id = document.getElementById('ppmpId').value;
            const type = document.getElementById('ppmpType').value;
            const year = document.getElementById('ppmpYear').value;
            const title = document.getElementById('ppmpTitle').value;
            const deadline = document.getElementById('ppmpDeadline').value;
            
            if (!type || !year || !title || !deadline) {
                alert('Please fill in all required fields');
                return;
            }
            
            if (id) {
                // Update existing PPMP
                const index = systemData.ppmpData.findIndex(p => p.id == id);
                if (index !== -1) {
                    systemData.ppmpData[index].type = type;
                    systemData.ppmpData[index].year = parseInt(year);
                    systemData.ppmpData[index].title = title;
                    systemData.ppmpData[index].deadline = deadline;
                }
            } else {
                // Check if regular PPMP already exists for this office and year
                if (type === 'regular') {
                    const existingRegularPPMP = systemData.ppmpData.find(ppmp => 
                        ppmp.office === systemData.currentOffice && 
                        ppmp.type === 'regular' && 
                        ppmp.year === parseInt(year)
                    );
                    
                    if (existingRegularPPMP) {
                        alert('A regular PPMP already exists for this office and year. Only one regular PPMP is allowed per office per year.');
                        return;
                    }
                }
                
                // Create new PPMP
                const newPPMP = {
                    id: systemData.ppmpData.length > 0 ? Math.max(...systemData.ppmpData.map(p => p.id)) + 1 : 1,
                    office: systemData.currentOffice,
                    type: type,
                    year: parseInt(year),
                    title: title,
                    status: 'draft',
                    deadline: deadline,
                    createdDate: new Date().toISOString().split('T')[0],
                    items: []
                };
                
                systemData.ppmpData.push(newPPMP);
            }
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('createPpmpModal'));
            modal.hide();
            
            // Reset form
            document.getElementById('ppmpForm').reset();
            
            // Reload appropriate view
            if (systemData.currentPPMPId) {
                viewPPMP(systemData.currentPPMPId);
            } else {
                loadPPMPModule();
            }
            
            alert('PPMP saved successfully!');
        }

        // Delete PPMP
        function deletePPMP(ppmpId) {
            if (!confirm('Are you sure you want to delete this PPMP? This action cannot be undone.')) {
                return;
            }
            
            const index = systemData.ppmpData.findIndex(p => p.id == ppmpId);
            if (index !== -1) {
                systemData.ppmpData.splice(index, 1);
                loadPPMPModule();
                alert('PPMP deleted successfully!');
            }
        }

        // Open Add Item Modal
        function openAddItemModal(ppmpId) {
            document.getElementById('itemId').value = '';
            document.getElementById('itemPpmpId').value = ppmpId;
            document.getElementById('itemName').value = '';
            document.getElementById('itemUnit').value = '';
            document.getElementById('itemUnitPrice').value = '';
            document.getElementById('itemQuantity').value = '';
            
            // Reset monthly quantities
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            months.forEach(month => {
                document.getElementById(`qty${month}`).value = '0';
            });
            
            document.getElementById('itemModalLabel').textContent = 'Add Item to PPMP';
            document.getElementById('monthlyTotal').textContent = 'Total: 0';
            
            const modal = new bootstrap.Modal(document.getElementById('itemModal'));
            modal.show();
            
            // Add event listeners to monthly quantity inputs
            document.querySelectorAll('.monthly-qty').forEach(input => {
                input.addEventListener('input', updateMonthlyTotal);
            });
        }

        // Edit Item
        function editItem(ppmpId, itemId) {
            const ppmp = systemData.ppmpData.find(p => p.id == ppmpId);
            if (!ppmp) return;
            
            const item = ppmp.items.find(i => i.id == itemId);
            if (!item) return;
            
            document.getElementById('itemId').value = item.id;
            document.getElementById('itemPpmpId').value = ppmpId;
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemUnit').value = item.unit;
            document.getElementById('itemUnitPrice').value = item.unitPrice;
            document.getElementById('itemQuantity').value = item.totalQty;
            
            // Set monthly quantities
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            months.forEach((month, index) => {
                document.getElementById(`qty${month}`).value = item.monthlyQty[index] || 0;
            });
            
            document.getElementById('itemModalLabel').textContent = 'Edit Item';
            updateMonthlyTotal();
            
            const modal = new bootstrap.Modal(document.getElementById('itemModal'));
            modal.show();
            
            // Add event listeners to monthly quantity inputs
            document.querySelectorAll('.monthly-qty').forEach(input => {
                input.addEventListener('input', updateMonthlyTotal);
            });
        }

        // Update Monthly Total
        function updateMonthlyTotal() {
            let total = 0;
            document.querySelectorAll('.monthly-qty').forEach(input => {
                total += parseInt(input.value) || 0;
            });
            document.getElementById('monthlyTotal').textContent = `Total: ${total}`;
            document.getElementById('itemQuantity').value = total;
        }

        // Save PPMP Item (Create or Update)
        function savePPMPItem() {
            const itemId = document.getElementById('itemId').value;
            const ppmpId = document.getElementById('itemPpmpId').value;
            const name = document.getElementById('itemName').value;
            const unit = document.getElementById('itemUnit').value;
            const unitPrice = parseFloat(document.getElementById('itemUnitPrice').value);
            const totalQty = parseInt(document.getElementById('itemQuantity').value);
            
            if (!name || !unit || !unitPrice || !totalQty) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Get monthly quantities
            const monthlyQty = [];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            months.forEach(month => {
                monthlyQty.push(parseInt(document.getElementById(`qty${month}`).value) || 0);
            });
            
            // Check if monthly quantities match total
            const monthlyTotal = monthlyQty.reduce((sum, qty) => sum + qty, 0);
            if (monthlyTotal !== totalQty) {
                alert('Total quantity does not match the sum of monthly quantities. Please adjust.');
                return;
            }
            
            const ppmp = systemData.ppmpData.find(p => p.id == ppmpId);
            if (!ppmp) {
                alert('PPMP not found');
                return;
            }
            
            if (itemId) {
                // Update existing item
                const itemIndex = ppmp.items.findIndex(i => i.id == itemId);
                if (itemIndex !== -1) {
                    ppmp.items[itemIndex] = {
                        ...ppmp.items[itemIndex],
                        name,
                        unit,
                        unitPrice,
                        totalQty,
                        monthlyQty,
                        totalAmount: unitPrice * totalQty
                    };
                }
            } else {
                // Create new item
                const newItem = {
                    id: ppmp.items.length > 0 ? Math.max(...ppmp.items.map(i => i.id)) + 1 : 1,
                    name,
                    unit,
                    unitPrice,
                    totalQty,
                    monthlyQty,
                    totalAmount: unitPrice * totalQty
                };
                ppmp.items.push(newItem);
            }
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('itemModal'));
            modal.hide();
            
            // Reset form
            document.getElementById('itemForm').reset();
            
            // Reload view
            viewPPMP(ppmpId);
            
            alert('Item saved successfully!');
        }

        // Confirm Delete Item
        function confirmDeleteItem(ppmpId, itemId, itemName) {
            document.getElementById('deleteConfirmText').textContent = `Are you sure you want to delete "${itemName}"? This action cannot be undone.`;
            
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            confirmBtn.onclick = function() {
                deleteItem(ppmpId, itemId);
                const modal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal'));
                modal.hide();
            };
            
            const modal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
            modal.show();
        }

        // Delete Item
        function deleteItem(ppmpId, itemId) {
            const ppmp = systemData.ppmpData.find(p => p.id == ppmpId);
            if (!ppmp) return;
            
            const itemIndex = ppmp.items.findIndex(i => i.id == itemId);
            if (itemIndex !== -1) {
                ppmp.items.splice(itemIndex, 1);
                viewPPMP(ppmpId);
                alert('Item deleted successfully!');
            }
        }

        // Purchase Request Module (simplified for this example)
        function loadPRModule() {
            const officePRs = systemData.prData.filter(pr => pr.office === systemData.currentOffice);
            
            let content = `
                <h2 class="module-title">Purchase Request Management</h2>
                
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-shopping-cart me-2"></i> Purchase Requests</span>
                        <div>
                            <button class="btn btn-primary btn-sm me-2">
                                <i class="fas fa-plus me-1"></i> Create PR
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="loadDashboard()">
                                <i class="fas fa-tachometer-alt me-1"></i> Dashboard
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info mb-4">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>PR Creation Rules:</strong> 
                            <ul class="mb-0 mt-2">
                                <li>PRs should primarily align with PPMP items.</li>
                                <li>Non-PPMP PRs require approval from GSO Officer, BAC Secretary, or Budget Officer.</li>
                                <li>Only the department head or assigned employee can approve and publish PRs.</li>
                            </ul>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Title</th>
                                        <th>Purpose</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            officePRs.forEach(pr => {
                const statusClass = `status-${pr.status}`;
                const statusLabel = `<span class="status-badge ${statusClass}">${pr.status}</span>`;
                
                content += `
                    <tr>
                        <td>PR-${pr.id}</td>
                        <td>${pr.title}</td>
                        <td>${pr.purpose}</td>
                        <td>PHP ${pr.totalAmount.toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                        <td>${statusLabel}</td>
                        <td>${pr.createdDate}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${pr.status === 'draft' || pr.status === 'pending' ? `
                                <button class="btn btn-sm btn-outline-success me-1">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            });
            
            content += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('moduleContent').innerHTML = content;
        }

        // Other modules (simplified placeholders)
        function loadValidateModule() {
            document.getElementById('moduleContent').innerHTML = '<h2 class="module-title">Validation & Approval</h2><p>Validation module content...</p>';
        }

        function loadRFQModule() {
            document.getElementById('moduleContent').innerHTML = '<h2 class="module-title">RFQ Management</h2><p>RFQ module content...</p>';
        }

        function loadStatusModule() {
            document.getElementById('moduleContent').innerHTML = '<h2 class="module-title">Update PR Status</h2><p>Status update module content...</p>';
        }

        function loadPhilgepsModule() {
            document.getElementById('moduleContent').innerHTML = '<h2 class="module-title">PHILGEPS Publication</h2><p>PHILGEPS module content...</p>';
        }

        function loadAPPModule() {
            document.getElementById('moduleContent').innerHTML = '<h2 class="module-title">Annual Procurement Plan</h2><p>APP module content...</p>';
        }

        function loadAppropriationModule() {
            document.getElementById('moduleContent').innerHTML = '<h2 class="module-title">Budget Appropriations</h2><p>Appropriation module content...</p>';
        }

        function loadReportsModule() {
            document.getElementById('moduleContent').innerHTML = '<h2 class="module-title">Reports</h2><p>Reports module content...</p>';
        }

        // Initialize the system
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            updateDate();
            
            // Set default deadline to 30 days from now
            const today = new Date();
            const nextMonth = new Date(today);
            nextMonth.setDate(today.getDate() + 30);
            document.getElementById('ppmpDeadline').valueAsDate = nextMonth;
            
            // Add event listeners for monthly quantity inputs
            document.querySelectorAll('.monthly-qty').forEach(input => {
                input.addEventListener('input', updateMonthlyTotal);
            });
        });
    </script>
</body>
</html>